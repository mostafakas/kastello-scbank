<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุจูู ููุงุฉ ุงูุณููุณ | ุงูุฎุฏูุงุช ุงููุตุฑููุฉ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; scroll-behavior: smooth; }
        .chart-container { position: relative; height: 300px; max-height: 40vh; width: 100%; max-width: 600px; margin-left: auto; margin-right: auto; }
        .page-hidden { display: none !important; }
        .modal-screen { transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out; }
        #app-content-wrapper { transition: opacity 0.5s ease-in-out; }
        .choice-button { transition: transform 0.2s ease-out, box-shadow 0.2s ease-out; }
        .choice-button:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .bank-logo-text { font-weight: 700; color: #0891b2; font-size: 1.75rem; line-height: 2.25rem; }
        .back-to-choice-section-button { background-color: #0e7490; color: white; padding: 0.625rem 1.5rem; border-radius: 0.375rem; font-weight: 600; }
        .back-to-choice-section-button:hover { background-color: #087287; }
        .input-style { width: 100%; padding: 0.5rem 0.75rem; border: 1px solid #D1D5DB; border-radius: 0.375rem; }
        .input-style:focus { outline: none; box-shadow: 0 0 0 2px #06B6D4; border-color: #06B6D4; }
    </style>
</head>
<body class="bg-slate-50 text-gray-800">

    <div id="login-modal" class="modal-screen fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-[100]">
        <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-sm mx-4 sm:max-w-md">
            <div class="flex justify-center mb-6"><div class="bank-logo-text">ุจูู ููุงุฉ ุงูุณููุณ</div></div>
            <h2 class="text-2xl font-bold text-center text-cyan-700 mb-6">ุชุณุฌูู ุงูุฏุฎูู</h2>
            <form id="login-form">
                <div class="mb-4"><label for="username" class="block text-sm font-medium text-gray-700 mb-1">ุงุณู ุงููุณุชุฎุฏู</label><input type="text" id="username" class="input-style" placeholder="ุงุฏุฎู ุงุณู ุงููุณุชุฎุฏู" required></div>
                <div class="mb-6"><label for="password" class="block text-sm font-medium text-gray-700 mb-1">ูููุฉ ุงููุฑูุฑ</label><input type="password" id="password" class="input-style" placeholder="ุงุฏุฎู ูููุฉ ุงููุฑูุฑ" required></div>
                <div id="login-error" class="text-red-600 text-sm mb-4 text-center font-semibold" style="display: none;"></div>
                <button type="submit" class="w-full bg-cyan-700 text-white py-2.5 px-4 rounded-md hover:bg-cyan-800 font-semibold">ุฏุฎููููู</button>
            </form>
        </div>
    </div>

    <div id="welcome-message-modal" class="modal-screen fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-[110]" style="display: none; opacity: 0; visibility: hidden;">
        <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-sm mx-4 text-center">
            <h2 id="welcome-text" class="text-2xl font-bold text-cyan-700 mb-4"></h2><p class="text-gray-600">ุฌุงุฑู ุชุญุถูุฑ ุญุณุงุจู...</p>
        </div>
    </div>

    <div id="product-choice-screen" class="modal-screen fixed inset-0 bg-slate-100 flex items-center justify-center z-[90]" style="display: none; opacity: 0; visibility: hidden;">
        <div class="bg-white p-8 sm:p-12 rounded-xl shadow-2xl w-full max-w-lg mx-4 text-center">
            <div class="flex justify-center mb-8"><div class="bank-logo-text">ุจูู ููุงุฉ ุงูุณููุณ</div></div>
            <h2 class="text-3xl font-bold text-cyan-800 mb-8">ุงุฎุชุฑ ุงูุฎุฏูุฉ ุงููุทููุจุฉ</h2>
            <p class="text-gray-600 mb-10 text-lg">ูุฑุญุจุงู ุจู <span id="welcome-username" class="font-semibold text-cyan-700"></span>! ูุฑุฌู ุงุฎุชูุงุฑ ููุน ุงูููุชุฌ.</p>
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
                <button data-choice="certificates" class="choice-button bg-cyan-600 text-white py-8 px-4 rounded-lg shadow-md hover:bg-cyan-700"><span class="text-5xl block mb-3">๐</span><span class="text-xl font-semibold">ุงูุดูุงุฏุงุช</span></button>
                <button data-choice="loans" class="choice-button bg-orange-500 text-white py-8 px-4 rounded-lg shadow-md hover:bg-orange-600"><span class="text-5xl block mb-3">๐ฐ</span><span class="text-xl font-semibold">ุงููุฑูุถ</span></button>
                <button data-choice="deposits" class="choice-button bg-teal-500 text-white py-8 px-4 rounded-lg shadow-md hover:bg-teal-600"><span class="text-5xl block mb-3">๐ฆ</span><span class="text-xl font-semibold">ุงููุฏุงุฆุน</span></button>
            </div>
            <button id="logout-button-choice" class="mt-10 text-sm text-gray-500 hover:text-cyan-700 underline">ุชุณุฌูู ุงูุฎุฑูุฌ</button>
        </div>
    </div>

    <div id="app-content-wrapper" class="page-hidden" style="opacity: 0;">
        <header class="bg-white shadow-md sticky top-0 z-50">
            <nav class="container mx-auto px-4 sm:px-6 lg:px-8"><div class="flex items-center justify-between h-16">
                <div class="flex items-center"><a href="#" id="header-logo-link" class="bank-logo-text">ุจูู ููุงุฉ ุงูุณููุณ</a></div>
                <div class="hidden md:block"><div id="main-nav-links" class="ml-10 flex items-baseline space-x-4 space-x-reverse">
                    <a href="#hero" class="nav-link text-gray-600 hover:text-cyan-700 px-3 py-2 text-sm font-medium">ุงูุฑุฆูุณูุฉ</a>
                    <a href="#calculator" class="nav-link text-gray-600 hover:text-cyan-700 px-3 py-2 text-sm font-medium">ุงูุญุงุณุจุฉ</a>
                    <a href="#contact" class="nav-link text-gray-600 hover:text-cyan-700 px-3 py-2 text-sm font-medium">ุชูุงุตู ูุนูุง</a>
                    <button id="logout-button-header" class="text-gray-600 hover:text-red-600 px-3 py-2 text-sm font-medium">ุชุณุฌูู ุงูุฎุฑูุฌ</button>
                </div></div>
                <div class="md:hidden"><button id="mobile-menu-button" class="p-2 text-gray-400 hover:text-white hover:bg-cyan-700 rounded-md"><span class="sr-only">ุงููุงุฆูุฉ</span><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" /></svg></button></div>
            </div></nav>
            <div id="mobile-menu" class="md:hidden hidden"><div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="#hero" class="nav-link text-gray-600 hover:bg-cyan-700 hover:text-white block px-3 py-2 text-base font-medium">ุงูุฑุฆูุณูุฉ</a>
                <a href="#calculator" class="nav-link text-gray-600 hover:bg-cyan-700 hover:text-white block px-3 py-2 text-base font-medium">ุงูุญุงุณุจุฉ</a>
                <a href="#contact" class="nav-link text-gray-600 hover:bg-cyan-700 hover:text-white block px-3 py-2 text-base font-medium">ุชูุงุตู ูุนูุง</a>
                <button id="logout-button-mobile" class="w-full text-left text-gray-600 hover:bg-red-600 hover:text-white block px-3 py-2 text-base font-medium">ุชุณุฌูู ุงูุฎุฑูุฌ</button>
            </div></div>
        </header>

        <main>
            <section id="hero" class="page-section bg-cyan-800 text-white pt-20 pb-24"><div class="container mx-auto px-4 text-center">
                <h1 id="hero-title" class="text-4xl md:text-5xl font-bold mb-4">ุงุณุชุซูุฑ ูุณุชูุจูู ุจุซูุฉ</h1>
                <p id="hero-subtitle" class="text-lg md:text-xl text-cyan-200 max-w-3xl mx-auto mb-8">ูุธุฑุฉ ุดุงููุฉ ุนูู ุฃุจุฑุฒ ููุชุฌุงุชูุง ุงููุตุฑููุฉ.</p>
                <a href="#calculator" class="bg-white text-cyan-800 font-bold py-3 px-8 rounded-full hover:bg-cyan-100">ุงุณุชูุดู ุงูุญุงุณุจุงุช</a>
            </div></section>
            
            <section id="products" class="page-section py-16 sm:py-20 page-hidden"> </section>

            <section id="calculator" class="page-section py-16 sm:py-20 bg-gray-100"><div class="container mx-auto px-4">
                <div class="text-center mb-12">
                    <h2 id="calculator-section-title" class="text-3xl md:text-4xl font-bold text-gray-900">ุงูุญุงุณุจุฉ ุงูุชูุงุนููุฉ</h2>
                    <p id="calculator-subtitle" class="mt-4 text-lg text-gray-600 max-w-2xl mx-auto">(ุงูุฃุฑูุงู ูู ุฃูุซูุฉ ุชูุถูุญูุฉ)</p>
                </div>
                <div class="max-w-4xl mx-auto grid md:grid-cols-2 gap-8 items-start">
                    <div id="certificate-total-earnings-wrapper" class="bg-white p-6 rounded-lg shadow-lg page-hidden">
                        <h3 class="text-xl font-bold mb-4 text-cyan-800">ุญุงุณุจุฉ ุฅุฌูุงูู ุฃุฑุจุงุญ ุงูุดูุงุฏุงุช</h3>
                        <div class="space-y-4">
                            <div><label for="cert-total-amount" class="block text-sm font-medium">ูุจูุบ ุงูุงุณุชุซูุงุฑ (ุฌ.ู)</label><input type="number" id="cert-total-amount" value="10000" min="1000" class="input-style mt-1"></div>
                            <div><label for="cert-total-rate" class="block text-sm font-medium">ุณุนุฑ ุงูุนุงุฆุฏ ุงูุณููู (%)</label><input type="number" id="cert-total-rate" value="20" min="1" step="0.1" class="input-style mt-1"></div>
                            <div><label for="cert-total-years" class="block text-sm font-medium">ูุฏุฉ ุงูุดูุงุฏุฉ (ุณููุงุช)</label><input type="number" id="cert-total-years" value="3" min="1" class="input-style mt-1"></div>
                        </div>
                        <div class="mt-6"><div class="chart-container"><canvas id="certificateTotalEarningsChart"></canvas></div></div>
                    </div>
                    <div id="certificate-periodic-payout-wrapper" class="bg-white p-6 rounded-lg shadow-lg page-hidden">
                        <h3 class="text-xl font-bold mb-4 text-cyan-800">ุญุงุณุจุฉ ุงูุนุงุฆุฏ ุงูุฏูุฑู ููุดูุงุฏุงุช</h3>
                        <div class="space-y-4">
                            <div><label for="cert-select-type" class="block text-sm font-medium">ุงุฎุชุฑ ุงูุดูุงุฏุฉ</label><select id="cert-select-type" class="input-style mt-1"><option value="triple_fixed">ุดูุงุฏุฉ ุงูุงุฏุฎุงุฑ ุงูุซูุงุซูุฉ (ุนุงุฆุฏ ุซุงุจุช)</option><option value="alhosad">ุดูุงุฏุฉ ุงูุญุตุงุฏ</option><option value="dollar_3yr">ุดูุงุฏุฉ ุฏููุงุฑูุฉ (3 ุณููุงุช)</option><option value="dollar_5yr">ุดูุงุฏุฉ ุฏููุงุฑูุฉ (5 ุณููุงุช)</option></select></div>
                            <div id="cert-rate-options-wrapper" class="space-y-1" style="display: none;"><label for="cert-select-rate-option" class="block text-sm font-medium">ุงุฎุชุฑ ููุน ุงูุนุงุฆุฏ</label><select id="cert-select-rate-option" class="input-style mt-1"></select></div>
                            <div class="mt-2"><p class="text-sm text-gray-500">ุงููุงุฆุฏุฉ ุงูุณูููุฉ ุงููุทุจูุฉ: <span id="payout-calc-display-rate" class="font-semibold text-cyan-700">0.00</span>%</p></div>
                            <div><label for="payout-calc-amount" id="payout-calc-amount-label" class="block text-sm font-medium">ูุจูุบ ุงูุดูุงุฏุฉ</label><input type="number" id="payout-calc-amount" value="10000" min="100" class="input-style mt-1"></div>
                            <div><label for="payout-calc-frequency" class="block text-sm font-medium">ุฏูุฑูุฉ ุตุฑู ุงูุนุงุฆุฏ (ููุญุณุงุจ)</label><select id="payout-calc-frequency" class="input-style mt-1"><option value="daily">ูููู</option><option value="monthly" selected>ุดูุฑู</option><option value="quarterly">ุฑุจุน ุณููู</option><option value="semi-annually">ูุตู ุณููู</option><option value="annually">ุณููู</option></select></div>
                        </div>
                        <div class="mt-6 text-center"><p id="periodic-payout-description" class="text-gray-600">ุงูุนุงุฆุฏ ุงูุดูุฑู ุงูููุฏุฑ:</p><p id="periodic-payout-result" class="text-2xl font-bold text-cyan-700">0.00 ุฌููู</p></div>
                    </div>
                    <div id="certs-back-button-container" class="md:col-span-2 mt-8 text-center page-hidden"><button class="back-to-choice-section-button">ุงุฎุชุฑ ููุชุฌ ุงุฎุฑ</button></div>

                    <div id="revamped-loan-calculator-wrapper" class="bg-white p-6 rounded-lg shadow-lg page-hidden md:col-span-2">
                        <h3 class="text-xl font-bold mb-4 text-cyan-800">ุญุงุณุจุฉ ุฃูุณุงุท ุงููุฑูุถ</h3>
                        <div class="grid md:grid-cols-2 gap-x-6 gap-y-4">
                            <div>
                                <label for="loan-select-type" class="block text-sm font-medium text-gray-700">ููุน ุงููุฑุถ</label>
                                <select id="loan-select-type" class="input-style mt-1"></select>
                            </div>
                            <div>
                                <label for="loan-manual-rate" class="block text-sm font-medium text-gray-700">ูุณุจุฉ ุงููุงุฆุฏุฉ ุงูุณูููุฉ (%)</label>
                                <input type="number" id="loan-manual-rate" value="15" min="1" max="100" step="0.1" class="input-style mt-1">
                            </div>
                            <div>
                                <label for="loan-custom-amount" class="block text-sm font-medium text-gray-700">ูููุฉ ุงููุฑุถ (ุจุงูุฌููู ุงููุตุฑู)</label>
                                <input type="number" id="loan-custom-amount" value="50000" min="1000" step="1000" class="input-style mt-1">
                            </div>
                            <div>
                                <label for="loan-custom-term-years" class="block text-sm font-medium text-gray-700">ูุชุฑุฉ ุงูุณุฏุงุฏ (ุณููุงุช)</label>
                                <input type="number" id="loan-custom-term-years" value="5" min="1" max="30" step="1" class="input-style mt-1">
                            </div>
                            <div class="md:col-span-2">
                                <label for="loan-repayment-frequency" class="block text-sm font-medium text-gray-700">ุฏูุฑูุฉ ุงุณุชุญูุงู ุงููุณุท</label>
                                <select id="loan-repayment-frequency" class="input-style mt-1">
                                    <option value="monthly" selected>ุดูุฑูุงู</option>
                                    <option value="quarterly">ุฑุจุน ุณูููุงู</option>
                                    <option value="semi-annually">ูุตู ุณูููุงู</option>
                                    <option value="annually">ุณูููุงู</option>
                                </select>
                            </div>
                        </div>
                        <div class="mt-6 text-center">
                            <p id="loan-custom-installment-description" class="text-gray-600">ุงููุณุท ุงูุดูุฑู ุงูููุฏุฑ:</p>
                            <p id="loan-custom-installment-result" class="text-2xl font-bold text-cyan-700">0.00 ุฌููู</p>
                        </div>
                    </div>
                    <div id="loans-back-button-container" class="md:col-span-2 mt-8 text-center page-hidden"><button class="back-to-choice-section-button">ุงุฎุชุฑ ููุชุฌ ุงุฎุฑ</button></div>
                    
                    <div id="term-deposit-calculator-wrapper" class="bg-white p-6 rounded-lg shadow-lg page-hidden md:col-span-2">
                        <h3 class="text-xl font-bold mb-4 text-cyan-800">ุญุงุณุจุฉ ุนุงุฆุฏ ุงููุฏุงุฆุน ูุฃุฌู</h3>
                        <div class="grid md:grid-cols-2 gap-x-6 gap-y-4">
                            <div><label for="dep-select-currency" class="block text-sm font-medium">ุนููุฉ ุงููุฏูุนุฉ</label><select id="dep-select-currency" class="input-style mt-1"><option value="EGP" selected>ุฌููู ูุตุฑู</option><option value="USD">ุฏููุงุฑ ุฃูุฑููู</option><option value="GBP">ุฌููู ุงุณุชุฑูููู</option><option value="EUR">ููุฑู</option></select></div>
                            <div><label for="dep-select-term" class="block text-sm font-medium">ูุฏุฉ ุงููุฏูุนุฉ</label><select id="dep-select-term" class="input-style mt-1"><option value="1W">ุฃุณุจูุน</option><option value="1M" selected>ุดูุฑ</option><option value="2M">ุดูุฑุงู</option><option value="3M">ุซูุงุซุฉ ุฃุดูุฑ</option><option value="6M">ุณุชุฉ ุฃุดูุฑ</option><option value="1Y">ุณูุฉ</option></select></div>
                            <div class="md:col-span-2"><label for="dep-calc-amount" id="dep-calc-amount-label" class="block text-sm font-medium">ูุจูุบ ุงููุฏูุนุฉ (ุจุงูุฌููู ุงููุตุฑู)</label><input type="number" id="dep-calc-amount" value="10000" min="100" class="input-style mt-1"></div>
                        </div>
                        <div class="mt-4"><p class="text-sm text-gray-500">ุณุนุฑ ุงููุงุฆุฏุฉ ุงูุณููู ุงููุทุจู: <span id="dep-display-rate" class="font-semibold text-cyan-700">0.00</span>%</p></div>
                        <div class="mt-6 text-center">
                            <p id="dep-interest-earned-description" class="text-gray-600">ุฅุฌูุงูู ุงูุนุงุฆุฏ ูููุฏูุนุฉ ุจููุงูุฉ ุงููุฏุฉ:</p>
                            <p id="dep-interest-earned-result" class="text-2xl font-bold text-cyan-700">0.00 ุฌููู</p>
                        </div>
                    </div>
                    <div id="deposits-back-button-container" class="md:col-span-2 mt-8 text-center page-hidden"><button class="back-to-choice-section-button">ุงุฎุชุฑ ููุชุฌ ุงุฎุฑ</button></div>
                </div>
            </div></section>
            
            <section id="contact" class="page-section bg-cyan-800 text-white"><div class="container mx-auto px-4 py-16"><div class="text-center mb-10"><h2 class="text-3xl md:text-4xl font-bold">ุฌุงูุฒ ูุชุจุฏุฃุ</h2><p class="mt-4 text-lg text-cyan-200 max-w-2xl mx-auto">ุชูุงุตู ูุนูุง ุฃู ูู ุจุฒูุงุฑุฉ ุฃูุฑุจ ูุฑุน.</p></div><div class="max-w-4xl mx-auto grid md:grid-cols-3 gap-8 text-center">
                <div class="bg-cyan-700/50 p-6 rounded-lg"><h3 class="text-xl font-bold mb-2">ุชูุถู ุจุฒูุงุฑุชูุง</h3><p class="text-cyan-200"><a href="https://scbank.com.eg/Ar/Locator.aspx" target="_blank" class="hover:underline">ุงุจุญุซ ุนู ุฃูุฑุจ ูุฑุน</a>.</p></div>
                <div class="bg-cyan-700/50 p-6 rounded-lg"><h3 class="text-xl font-bold mb-2">ุงุชุตู ุจูุง</h3><p class="text-cyan-200">ุงูุฎุท ุงูุณุงุฎู: <span class="font-bold tracking-wider">19093</span></p></div>
                <div class="bg-cyan-700/50 p-6 rounded-lg"><h3 class="text-xl font-bold mb-2">ุชุงุจุนูุง ุฃูููุงูู</h3><p class="text-cyan-200"><a href="https://scbank.com.eg/Ar/" target="_blank" class="hover:underline">ูููุนูุง ูุชุทุจููุงุชูุง</a>.</p></div>
            </div></div></section>
        </main>
        
        <footer class="bg-gray-900 text-white"><div class="container mx-auto px-4 py-6 text-center"><p>&copy; <span id="current-year"></span> ุจูู ููุงุฉ ุงูุณููุณ. ูู ุงูุญููู ูุญููุธุฉ.</p><p class="text-sm text-gray-400 mt-2">ุนุฑุถ ุชูุถูุญู. ุงูุจูุงูุงุช ุฃูุซูุฉ ููุฏ ุชุฎุชูู.</p></div></footer>
    </div>

<script>
// JavaScript code remains identical to the version provided in the previous turn
// where the login modal was the simple centered one and all calculators were functional.
// The key is that the HTML for the login modal in this response
// is reverted to the simpler design, and the CSS for background effects
// like '.professional-login-bg' and its pseudo-elements are removed or not applied.
document.addEventListener('DOMContentLoaded', function () {
    // --- Element Selectors (original selectors for login modal) ---
    const loginModal = document.getElementById('login-modal');
    const loginForm = document.getElementById('login-form');
    const loginError = document.getElementById('login-error');
    const usernameInput = document.getElementById('username'); // For original login modal
    const passwordInput = document.getElementById('password'); // For original login modal

    const productChoiceScreen = document.getElementById('product-choice-screen');
    const appContentWrapper = document.getElementById('app-content-wrapper');
    const welcomeUsernameSpan = document.getElementById('welcome-username');
    const headerLogoLink = document.getElementById('header-logo-link');
    const welcomeMessageModal = document.getElementById('welcome-message-modal');
    const welcomeText = document.getElementById('welcome-text');
    const allPageSections = document.querySelectorAll('.page-section');
    const productsSection = document.getElementById('products');
    const calculatorSectionTitle = document.getElementById('calculator-section-title');

    // Certificate Calculator Elements
    const certificateTotalEarningsWrapper = document.getElementById('certificate-total-earnings-wrapper');
    const certificatePeriodicPayoutWrapper = document.getElementById('certificate-periodic-payout-wrapper');
    const certsBackButtonContainer = document.getElementById('certs-back-button-container');
    const certTotalAmountEl = document.getElementById('cert-total-amount');
    const certTotalRateEl = document.getElementById('cert-total-rate');
    const certTotalYearsEl = document.getElementById('cert-total-years');
    const certSelectTypeEl = document.getElementById('cert-select-type');
    const certRateOptionsWrapperEl = document.getElementById('cert-rate-options-wrapper');
    const certSelectRateOptionEl = document.getElementById('cert-select-rate-option');
    const payoutCalcDisplayRateEl = document.getElementById('payout-calc-display-rate');
    const payoutCalcAmountEl = document.getElementById('payout-calc-amount');
    const payoutCalcAmountLabelEl = document.getElementById('payout-calc-amount-label');
    const payoutCalcFrequencyEl = document.getElementById('payout-calc-frequency');
    const periodicPayoutDescriptionEl = document.getElementById('periodic-payout-description');
    const periodicPayoutResultEl = document.getElementById('periodic-payout-result');
    
    // Revamped Loan Calculator Elements
    const revampedLoanCalculatorWrapper = document.getElementById('revamped-loan-calculator-wrapper');
    const loansBackButtonContainer = document.getElementById('loans-back-button-container');
    const loanSelectTypeEl = document.getElementById('loan-select-type');
    const loanManualRateEl = document.getElementById('loan-manual-rate');
    const loanCustomAmountEl = document.getElementById('loan-custom-amount');
    const loanCustomTermYearsEl = document.getElementById('loan-custom-term-years');
    const loanRepaymentFrequencyEl = document.getElementById('loan-repayment-frequency');
    const loanCustomInstallmentDescEl = document.getElementById('loan-custom-installment-description');
    const loanCustomInstallmentResultEl = document.getElementById('loan-custom-installment-result');

    // Deposit Calculator Elements (New Revamped)
    const termDepositCalculatorWrapper = document.getElementById('term-deposit-calculator-wrapper');
    const depositsBackButtonContainer = document.getElementById('deposits-back-button-container');
    const depSelectCurrencyEl = document.getElementById('dep-select-currency');
    const depSelectTermEl = document.getElementById('dep-select-term');
    const depCalcAmountEl = document.getElementById('dep-calc-amount');
    const depCalcAmountLabelEl = document.getElementById('dep-calc-amount-label');
    const depDisplayRateEl = document.getElementById('dep-display-rate');
    const depInterestEarnedDescEl = document.getElementById('dep-interest-earned-description');
    const depInterestEarnedResultEl = document.getElementById('dep-interest-earned-result');

    let currentCertificateAnnualRate = 0;
    let certificateTotalEarningsChart;

    // --- Data Definitions ---
    const certificateDefinitions = { 
        triple_fixed: { name: "ุดูุงุฏุฉ ุงูุงุฏุฎุงุฑ ุงูุซูุงุซูุฉ (ุนุงุฆุฏ ุซุงุจุช)", options: [{ text: "ุนุงุฆุฏ ุซุงุจุช 19.5%", annualRate: 19.5, currency: "EGP" }] },
        alhosad: { name: "ุดูุงุฏุฉ ุงูุญุตุงุฏ", options: [{ text: "ุนุงุฆุฏ ูููู 23.25% (ุณููู ููุงูุฆ)", annualRate: 23.25, currency: "EGP" }, { text: "ุนุงุฆุฏ ุณููู 23.75%", annualRate: 23.75, currency: "EGP" }] },
        dollar_3yr: { name: "ุดูุงุฏุฉ ุฏููุงุฑูุฉ (3 ุณููุงุช)", options: [{ text: "ุนุงุฆุฏ ุดูุฑู 5.15% (ุณููู ููุงูุฆ)", annualRate: 5.15, currency: "USD" }, { text: "ุนุงุฆุฏ ุณููู 5.30%", annualRate: 5.30, currency: "USD" }] },
        dollar_5yr: { name: "ุดูุงุฏุฉ ุฏููุงุฑูุฉ (5 ุณููุงุช)", options: [{ text: "ุนุงุฆุฏ ุดูุฑู 5.00% (ุณููู ููุงูุฆ)", annualRate: 5.00, currency: "USD" }, { text: "ุนุงุฆุฏ ุณููู 5.15%", annualRate: 5.15, currency: "USD" }] }
    };
    const loanTypes = [ "ุงูุชูููู ุงูุดุฎุตู", "ูุฑุถ ุจุถูุงู ุงูุฑุงุชุจ", "ูุฑุถ ุจุถูุงู ุชุญููู ุงูุฑุงุชุจ ุฃู ุงููุณุท", "ูุฑุถ ููุฃูุฑุงุฏ ุจุฏูู ุชุญููู ุงูุฑุงุชุจ/ ุงููุณุท", "ูุฑุถ ูููุธูู ุงูุจููู", "ูุฑุถ ูุถุจุงุท ุงูุฌูุด ูุงููุชูุงุนุฏูู", "ูุฑุถ ูุถุจุงุท ุงูุดุฑุทุฉ ูุงููุชูุงุนุฏูู", "ูุฑุถ ูุฃุตุญุงุจ ุงูุฃูุดุทุฉ ูุงูููู ุงูุญุฑุฉ", "ูุฑุถ ูุฃุตุญุงุจ ุงููุนุงุดุงุช", "ุงููุฑุถ ุงูุชุนูููู", "ุชูููู ุนุถููุฉ ูุงุฏู ุณูุงุด ุงูุฑูุงุถู", "ุชูููู ุนุถููุฉ ุงูุฃูุฏูุฉ ุงูุฑูุงุถูุฉ", "ูุฑุถ ุงูุฃุทุจุงุก", "ูุฑุถ ุจุถูุงู ุชููู ุนูุงุฑ", "ูุฑุถ ุจุถูุงู ุจุทุงูุฉ ุงุฆุชูุงููุฉ", "ูุฑุถ ุจุถูุงู ุงูุณุฌู ุงูุงุฆุชูุงูู(I-Score)", "ูุฑุถ ุจุถูุงู ุฃูุนูุฉ ุงุฏุฎุงุฑูุฉ", "ูุฑุถ ุจุถูุงู ุฌุฒุฆู", "ููุชุฌ ุงูุชูููู ุงูุนูุงุฑู", "ุงูุชูููู ุงูุนูุงุฑู ููุญุฏูุฏู ุงูุฏุฎู", "ุงูุชูููู ุงูุนูุงุฑู ููุชูุณุทู ุงูุฏุฎู 3 %", "ุงูุชูููู ุงูุนูุงุฑู ููุชูุณุทู ุงูุฏุฎู 8 %", "ูุจุงุฏุฑุฉ ุงูุจูู ุงููุฑูุฒู ูุฅุญูุงู ุงููุฑูุจุงุช (Go Green)", "ุชูููู ุงูุทุงูุฉ ุงููุธููุฉ ูุงูููุชุฌุฏุฏุฉ", "ูุฑุถ ุงูุณูุงุฑุฉ" ];
    const depositInterestRates = { 
        "EGP": [ { minAmount: 10000, maxAmount: Infinity, rates: { "1W": 7.75 } }, { minAmount: 2000, maxAmount: Infinity, rates: { "1M": 11.25, "2M": 0.00, "3M": 11.75, "6M": 12.25, "1Y": 12.75 } } ],
        "USD": [ { minAmount: 100, maxAmount: 49999, rates: { "1W": 2.99, "1M": 3.02178, "2M": 2.97178, "3M": 2.48037, "6M": 2.33353, "1Y": 1.56408 } }, { minAmount: 50000, maxAmount: 149999, rates: { "1W": 3.04, "1M": 3.07178, "2M": 3.02178, "3M": 2.53037, "6M": 2.38353, "1Y": 1.61408 } }, { minAmount: 150000, maxAmount: 299999, rates: { "1W": 3.09, "1M": 3.12178, "2M": 3.07178, "3M": 2.58037, "6M": 2.43353, "1Y": 1.66408 } }, { minAmount: 300000, maxAmount: 499999, rates: { "1W": 3.14, "1M": 3.17178, "2M": 3.12178, "3M": 2.63037, "6M": 2.48353, "1Y": 1.71408 } }, { minAmount: 500000, maxAmount: Infinity, rates: { "1W": 3.19, "1M": 3.22178, "2M": 3.17178, "3M": 2.68037, "6M": 2.53353, "1Y": 1.76408 } } ],
        "GBP": [ { minAmount: 100, maxAmount: Infinity, rates: { "1W": 0.001, "1M": 0.001, "2M": 0.001, "3M": 0.001, "6M": 0.001, "1Y": 0.001 } } ],
        "EUR": [ { minAmount: 100, maxAmount: Infinity, rates: { "1W": 0.001, "1M": 0.001, "2M": 0.001, "3M": 0.001, "6M": 0.001, "1Y": 0.001 } } ]
    };
    const termDurationsInYears = { "1W": 1/52, "1M": 1/12, "2M": 2/12, "3M": 3/12, "6M": 6/12, "1Y": 1 };
    const currencySymbols = { EGP: "ุฌููู", USD: "ุฏููุงุฑ", GBP: "ุงุณุชุฑูููู", EUR: "ููุฑู" };

    function resetAppContent() {
        allPageSections.forEach(s => s.classList.add('page-hidden')); 
        if (productsSection) productsSection.classList.add('page-hidden');
        const allCalculatorsAndButtons = [
            certificateTotalEarningsWrapper, certificatePeriodicPayoutWrapper, certsBackButtonContainer,
            revampedLoanCalculatorWrapper, loansBackButtonContainer, 
            termDepositCalculatorWrapper, depositsBackButtonContainer
        ];
        allCalculatorsAndButtons.forEach(el => { if(el) el.classList.add('page-hidden'); });
    }
    function showProductChoiceScreen() { 
        resetAppContent();
        if(appContentWrapper) { appContentWrapper.style.opacity = '0'; appContentWrapper.classList.add('page-hidden'); }
        setTimeout(() => {
            if(appContentWrapper) appContentWrapper.style.display = 'none';
            if(productChoiceScreen) { productChoiceScreen.style.display = 'flex'; setTimeout(() => { productChoiceScreen.style.opacity = '1'; productChoiceScreen.style.visibility = 'visible'; }, 50); }
        }, 300);
    }
    if(headerLogoLink) headerLogoLink.addEventListener('click', (e) => { e.preventDefault(); showProductChoiceScreen(); });
    
    loginForm.addEventListener('submit', function(event) { 
        event.preventDefault(); 
        const enteredUsername = usernameInput.value.trim(); 
        const enteredPassword = passwordInput.value.trim(); 
        if (enteredUsername === "ูุตุทูู" && enteredPassword === "ูุงุณุชููู") {
            loginModal.style.opacity = '0'; loginModal.style.visibility = 'hidden';
            setTimeout(() => {
                loginModal.style.display = 'none';
                if(welcomeText) welcomeText.textContent = `ุฃููุงู ุจูุ ${enteredUsername}!`; 
                if(welcomeUsernameSpan) welcomeUsernameSpan.textContent = enteredUsername;
                if(welcomeMessageModal) { welcomeMessageModal.style.display = 'flex'; setTimeout(() => { welcomeMessageModal.style.opacity = '1'; welcomeMessageModal.style.visibility = 'visible'; }, 50); }
                setTimeout(() => {
                    if(welcomeMessageModal) { welcomeMessageModal.style.opacity = '0'; welcomeMessageModal.style.visibility = 'hidden'; setTimeout(() => { welcomeMessageModal.style.display = 'none'; showProductChoiceScreen(); }, 300); }
                    else { showProductChoiceScreen(); }
                }, 3000); 
            }, 300); 
        } else { 
            loginError.textContent = 'ุงุณู ุงููุณุชุฎุฏู ุฃู ูููุฉ ุงููุฑูุฑ ุบูุฑ ุตุญูุญุฉ.'; 
            loginError.style.display = 'block'; 
            if(passwordInput) passwordInput.value = ''; 
            if(usernameInput) usernameInput.focus(); 
        }
    });
    document.querySelectorAll('#logout-button-choice, #logout-button-header, #logout-button-mobile').forEach(btn => { 
        btn.addEventListener('click', function() {
            if(usernameInput) usernameInput.value = ''; 
            if(passwordInput) passwordInput.value = ''; 
            if(loginError) loginError.style.display = 'none';
            if(appContentWrapper) appContentWrapper.style.opacity = '0'; if(productChoiceScreen) { productChoiceScreen.style.opacity = '0'; productChoiceScreen.style.visibility = 'hidden';}
            setTimeout(() => {
                if(appContentWrapper) { appContentWrapper.style.display = 'none'; appContentWrapper.classList.add('page-hidden');}
                if(productChoiceScreen) productChoiceScreen.style.display = 'none';
                if(loginModal) { 
                    loginModal.style.display = 'flex'; 
                    setTimeout(() => { loginModal.style.opacity = '1'; loginModal.style.visibility = 'visible'; if(usernameInput) usernameInput.focus(); }, 50);
                }
            }, 300);
        });
    });
    document.querySelectorAll('.choice-button').forEach(button => { 
        button.addEventListener('click', function() {
            const choice = this.dataset.choice; if(productChoiceScreen) { productChoiceScreen.style.opacity = '0'; productChoiceScreen.style.visibility = 'hidden';}
            setTimeout(() => {
                if(productChoiceScreen) productChoiceScreen.style.display = 'none';
                if(appContentWrapper) { appContentWrapper.style.display = 'block'; appContentWrapper.classList.remove('page-hidden'); setTimeout(() => { appContentWrapper.style.opacity = '1'; configureAppForService(choice); }, 50); }
            }, 300);
        });
    });
    document.querySelectorAll('.back-to-choice-section-button').forEach(button => button.addEventListener('click', showProductChoiceScreen));

    function configureAppForService(serviceType) {
        resetAppContent(); 
        document.getElementById('hero')?.classList.remove('page-hidden');
        document.getElementById('calculator')?.classList.remove('page-hidden');
        document.getElementById('contact')?.classList.remove('page-hidden');
        if (productsSection) productsSection.classList.add('page-hidden');

        let currentCalcTitle = "ุงูุญุงุณุจุฉ ุงูุชูุงุนููุฉ";
        if (serviceType === "certificates") {
            currentCalcTitle = "ุญุงุณุจุงุช ุงูุดูุงุฏุงุช";
            if(certificateTotalEarningsWrapper) certificateTotalEarningsWrapper.classList.remove('page-hidden');
            if(certificatePeriodicPayoutWrapper) certificatePeriodicPayoutWrapper.classList.remove('page-hidden');
            if(certsBackButtonContainer) certsBackButtonContainer.classList.remove('page-hidden');
            updateCertificateTypeChanged();
        } else if (serviceType === "loans") {
            currentCalcTitle = "ุญุงุณุจุฉ ุฃูุณุงุท ุงููุฑูุถ";
            if(revampedLoanCalculatorWrapper) revampedLoanCalculatorWrapper.classList.remove('page-hidden'); 
            if(loansBackButtonContainer) loansBackButtonContainer.classList.remove('page-hidden');
            populateLoanTypes(); updateRevampedLoanCalculator(); 
        } else if (serviceType === "deposits") {
            currentCalcTitle = "ุญุงุณุจุฉ ุงููุฏุงุฆุน ูุฃุฌู";
            if(termDepositCalculatorWrapper) termDepositCalculatorWrapper.classList.remove('page-hidden');
            if(depositsBackButtonContainer) depositsBackButtonContainer.classList.remove('page-hidden');
            updateNewDepositCalculator();
        }
        if(calculatorSectionTitle) calculatorSectionTitle.textContent = currentCalcTitle;
        
        const heroSectionEl = document.getElementById('hero');
        if (heroSectionEl) { setTimeout(() => { window.scrollTo({ top: 0, behavior: 'smooth' }); }, 100); }
        initializeAppFunctions(serviceType);
    }
    
    function updateCertificateTypeChanged() { 
        if (!certSelectTypeEl || !certRateOptionsWrapperEl || !certSelectRateOptionEl || !payoutCalcDisplayRateEl || !payoutCalcAmountLabelEl) return;
        const selectedCertKey = certSelectTypeEl.value; const certDef = certificateDefinitions[selectedCertKey];
        certSelectRateOptionEl.innerHTML = ''; 
        if (certDef.options.length > 1) {
            certRateOptionsWrapperEl.style.display = 'block';
            certDef.options.forEach((opt, index) => {
                const optionEl = document.createElement('option'); optionEl.value = opt.annualRate; optionEl.textContent = opt.text; optionEl.dataset.currency = opt.currency;
                if (index === 0) { optionEl.selected = true; currentCertificateAnnualRate = opt.annualRate; payoutCalcDisplayRateEl.textContent = opt.annualRate.toFixed(2); updateCertAmountLabelCurrency(opt.currency); }
                certSelectRateOptionEl.appendChild(optionEl);
            });
        } else { 
            certRateOptionsWrapperEl.style.display = 'none'; currentCertificateAnnualRate = certDef.options[0].annualRate; payoutCalcDisplayRateEl.textContent = certDef.options[0].annualRate.toFixed(2); updateCertAmountLabelCurrency(certDef.options[0].currency);
        }
        updatePeriodicCertPayout();
    }
    function updateCertificateRateOptionChanged() { 
        if (!certSelectRateOptionEl || !payoutCalcDisplayRateEl || !payoutCalcAmountLabelEl) return;
        const selectedOption = certSelectRateOptionEl.options[certSelectRateOptionEl.selectedIndex];
        currentCertificateAnnualRate = parseFloat(selectedOption.value); payoutCalcDisplayRateEl.textContent = currentCertificateAnnualRate.toFixed(2);
        updateCertAmountLabelCurrency(selectedOption.dataset.currency); updatePeriodicCertPayout();
    }
    function updateCertAmountLabelCurrency(currency) { 
        if (payoutCalcAmountLabelEl) { payoutCalcAmountLabelEl.textContent = `ูุจูุบ ุงูุดูุงุฏุฉ (${currency === "USD" ? "ุจุงูุฏููุงุฑ" : "ุจุงูุฌููู ุงููุตุฑู"})`; }
    }
    function updatePeriodicCertPayout() { 
        if (!payoutCalcAmountEl || !payoutCalcFrequencyEl || !periodicPayoutResultEl || !periodicPayoutDescriptionEl || (certificatePeriodicPayoutWrapper && certificatePeriodicPayoutWrapper.classList.contains('page-hidden'))) return;
        const amount = parseFloat(payoutCalcAmountEl.value) || 0; const calculationFrequency = payoutCalcFrequencyEl.value;
        const selectedCertKey = certSelectTypeEl.value; const certDef = certificateDefinitions[selectedCertKey];
        let currencySymbol = "ุฌููู";
        if (certDef) { const currentRateOptionIndex = certDef.options.length > 1 && certSelectRateOptionEl.selectedIndex >= 0 ? certSelectRateOptionEl.selectedIndex : 0; if (certDef.options[currentRateOptionIndex] && certDef.options[currentRateOptionIndex].currency === "USD") { currencySymbol = "ุฏููุงุฑ"; } }
        if (amount <= 0 || currentCertificateAnnualRate <= 0) { periodicPayoutDescriptionEl.textContent = "ุงูุนุงุฆุฏ ุงูุฏูุฑู ุงูููุฏุฑ:"; periodicPayoutResultEl.textContent = `0.00 ${currencySymbol}`; return; }
        let payout = 0; const annualRateDecimal = currentCertificateAnnualRate / 100; let descriptionText = ""; let periodsPerYear = 12;
        switch (calculationFrequency) { case "daily": periodsPerYear = 365; descriptionText = "ุงูุนุงุฆุฏ ุงููููู ุงูููุฏุฑ:"; break; case "monthly": periodsPerYear = 12; descriptionText = "ุงูุนุงุฆุฏ ุงูุดูุฑู ุงูููุฏุฑ:"; break; case "quarterly": periodsPerYear = 4; descriptionText = "ุงูุนุงุฆุฏ ุงูุฑุจุน ุณููู ุงูููุฏุฑ:"; break; case "semi-annually": periodsPerYear = 2; descriptionText = "ุงูุนุงุฆุฏ ุงููุตู ุณููู ุงูููุฏุฑ:"; break; case "annually": periodsPerYear = 1; descriptionText = "ุงูุนุงุฆุฏ ุงูุณููู ุงูููุฏุฑ:"; break; }
        payout = amount * (annualRateDecimal / periodsPerYear);
        periodicPayoutDescriptionEl.textContent = descriptionText; periodicPayoutResultEl.textContent = `${payout.toFixed(2)} ${currencySymbol}`;
    }

    function populateLoanTypes() { 
        if (!loanSelectTypeEl) return;
        loanSelectTypeEl.innerHTML = ''; 
        loanTypes.forEach(type => { const option = document.createElement('option'); option.value = type; option.textContent = type; loanSelectTypeEl.appendChild(option); });
    }
    function updateRevampedLoanCalculator() { 
        if (!loanManualRateEl || !loanCustomAmountEl || !loanCustomTermYearsEl || !loanRepaymentFrequencyEl || !loanCustomInstallmentDescEl || !loanCustomInstallmentResultEl || (revampedLoanCalculatorWrapper && revampedLoanCalculatorWrapper.classList.contains('page-hidden'))) return;
        const annualRate = parseFloat(loanManualRateEl.value) || 0; const P = parseFloat(loanCustomAmountEl.value) || 0; 
        const termYears = parseInt(loanCustomTermYearsEl.value) || 0; const frequency = loanRepaymentFrequencyEl.value;
        let periodsPerYear = 12; let descText = "ุงููุณุท ุงูุดูุฑู ุงูููุฏุฑ:";
        if (frequency === "quarterly") { periodsPerYear = 4; descText = "ุงููุณุท ุงูุฑุจุน ุณููู ุงูููุฏุฑ:"; } else if (frequency === "semi-annually") { periodsPerYear = 2; descText = "ุงููุณุท ุงููุตู ุณููู ุงูููุฏุฑ:"; } else if (frequency === "annually") { periodsPerYear = 1; descText = "ุงููุณุท ุงูุณููู ุงูููุฏุฑ:"; }
        let installment = 0;
        if (P > 0 && termYears > 0 && annualRate >= 0 && annualRate <=100) { const i = (annualRate / 100) / periodsPerYear; const n = termYears * periodsPerYear; if (annualRate === 0 || i === 0) { installment = P / n; } else { installment = P * i * Math.pow(1 + i, n) / (Math.pow(1 + i, n) - 1); } }
        loanCustomInstallmentDescEl.textContent = descText; loanCustomInstallmentResultEl.textContent = `${installment.toFixed(2)} ุฌููู`;
    }

    function lookupDepositRate(currency, termKey, amount) { 
        const rateTiers = depositInterestRates[currency]; if (!rateTiers) return 0;
        let applicableRate = 0;
        if (currency === "EGP") { 
            const specificHighTier = rateTiers.find(tier => tier.minAmount === 10000 && tier.rates[termKey] !== undefined);
            if (specificHighTier && amount >= specificHighTier.minAmount) { return specificHighTier.rates[termKey]; } 
            const generalTier = rateTiers.find(tier => tier.minAmount === 2000 && tier.rates[termKey] !== undefined);
            if (generalTier && amount >= generalTier.minAmount) { return generalTier.rates[termKey]; }
            return 0; 
        } else { 
            for (const tier of rateTiers) { // Corrected iteration for USD, GBP, EUR
                if (amount >= tier.minAmount && amount <= (tier.maxAmount || Infinity)) {
                    if (tier.rates && tier.rates[termKey] !== undefined) {
                        applicableRate = tier.rates[termKey];
                        break; 
                    }
                }
            }
        }
        return applicableRate;
    }
    function updateNewDepositCalculator() { 
        if (!depSelectCurrencyEl || !depSelectTermEl || !depCalcAmountEl || !depDisplayRateEl || !depInterestEarnedResultEl || !depCalcAmountLabelEl || (termDepositCalculatorWrapper && termDepositCalculatorWrapper.classList.contains('page-hidden'))) return;
        const currency = depSelectCurrencyEl.value; const termKey = depSelectTermEl.value; const amount = parseFloat(depCalcAmountEl.value) || 0;
        depCalcAmountLabelEl.textContent = `ูุจูุบ ุงููุฏูุนุฉ (${currencySymbols[currency] || currency})`;
        const annualRate = lookupDepositRate(currency, termKey, amount); depDisplayRateEl.textContent = annualRate.toFixed(3);
        let interestEarned = 0; const termDuration = termDurationsInYears[termKey];
        if (amount > 0 && annualRate > 0 && termDuration > 0) { interestEarned = amount * (annualRate / 100) * termDuration; }
        depInterestEarnedDescEl.textContent = `ุฅุฌูุงูู ุงูุนุงุฆุฏ ูููุฏูุนุฉ (ููุฏุฉ ${depSelectTermEl.options[depSelectTermEl.selectedIndex].text}):`;
        depInterestEarnedResultEl.textContent = `${interestEarned.toFixed(2)} ${currencySymbols[currency] || currency}`;
    }

    function updateCertificateTotalEarnings() { 
         if(!certTotalAmountEl || (certificateTotalEarningsWrapper && certificateTotalEarningsWrapper.classList.contains('page-hidden'))) return;
        const amount = parseFloat(certTotalAmountEl.value) || 0, rate = parseFloat(certTotalRateEl.value) || 0, years = parseInt(certTotalYearsEl.value) || 0;
        const labels = Array.from({ length: years + 1 }, (_, i) => `ุณูุฉ ${i}`); let currentAmount = amount; const data = [currentAmount];
        for (let i = 0; i < years; i++) { currentAmount += currentAmount * (rate / 100); data.push(parseFloat(currentAmount.toFixed(2))); }
        const chartData = { labels, datasets: [{ label: 'ุฅุฌูุงูู ุฃุฑุจุงุญ ุงูุดูุงุฏุฉ', data, borderColor: '#0e7490', backgroundColor: 'rgba(14, 116, 144, 0.1)', fill: true }] };
        const ctx = document.getElementById('certificateTotalEarningsChart')?.getContext('2d'); if(!ctx) return;
        if (certificateTotalEarningsChart) certificateTotalEarningsChart.destroy();
        certificateTotalEarningsChart = new Chart(ctx, { type: 'line', data: chartData, options: { responsive: true, maintainAspectRatio:false, plugins:{legend:{labels:{font:{family:'Cairo'}}}}, scales:{y:{ticks:{callback:v=>`${v} ุฌ.ู`,font:{family:'Cairo'}}},x:{ticks:{font:{family:'Cairo'}}}}}});
    }
    
    function initializeAppFunctions(currentServiceType) {
        if(document.getElementById('current-year')) document.getElementById('current-year').textContent = new Date().getFullYear();
        const navLinks = document.querySelectorAll('header a.nav-link[href^="#"]');
        navLinks.forEach(anchor => { anchor.addEventListener('click', function (e) { e.preventDefault(); const targetId = this.getAttribute('href'), targetElement = document.querySelector(targetId); if (targetElement) { const offsetPosition = targetElement.offsetTop - (document.querySelector('header')?.offsetHeight || 70); window.scrollTo({ top: offsetPosition, behavior: "smooth" }); } const mobileMenu = document.getElementById('mobile-menu'); if (mobileMenu && !mobileMenu.classList.contains('hidden')) mobileMenu.classList.add('hidden'); }); });
        const mobileMenu = document.getElementById('mobile-menu'), mobileMenuButton = document.getElementById('mobile-menu-button');
        if (mobileMenuButton && mobileMenu) mobileMenuButton.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));
        
        if (certTotalAmountEl) { [certTotalAmountEl, certTotalRateEl, certTotalYearsEl].forEach(el => el?.addEventListener('input', updateCertificateTotalEarnings)); }
        if (certSelectTypeEl) certSelectTypeEl.addEventListener('change', updateCertificateTypeChanged);
        if (certSelectRateOptionEl) certSelectRateOptionEl.addEventListener('change', updateCertificateRateOptionChanged);
        if (payoutCalcAmountEl) payoutCalcAmountEl.addEventListener('input', updatePeriodicCertPayout);
        if (payoutCalcFrequencyEl) payoutCalcFrequencyEl.addEventListener('change', updatePeriodicCertPayout);
        if (currentServiceType === 'certificates') { updateCertificateTotalEarnings(); updateCertificateTypeChanged(); }

        const revampedLoanInputs = [loanManualRateEl, loanCustomAmountEl, loanCustomTermYearsEl, loanRepaymentFrequencyEl, loanSelectTypeEl];
        revampedLoanInputs.forEach(el => { if(el) el.addEventListener('input', updateRevampedLoanCalculator); });
        if (currentServiceType === 'loans') { populateLoanTypes(); updateRevampedLoanCalculator(); }
        
        const termDepositInputs = [depSelectCurrencyEl, depSelectTermEl, depCalcAmountEl];
        termDepositInputs.forEach(el => { if(el) el.addEventListener('input', updateNewDepositCalculator); });
        if (currentServiceType === 'deposits') { updateNewDepositCalculator(); }
    }
});
</script>
</body>
</html>
